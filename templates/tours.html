<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MeBest Travel | Tours</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
        integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <link rel="stylesheet" href="/static/header_footer.css" />
    <link rel="stylesheet" href="/static/tours.css" />
  </head>
  <body>
    <!-- navbar -->
    <nav id="navbar" class="navbar navbar-expand-lg fixed-top">
      <div class="container-fluid">
        <div class="wrap-brand">
          <a class="navbar-brand" href="#"
            ><img src="/static/logo.png" width="100%" height="70px" alt=""
          /></a>
        </div>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNavDropdown"
          aria-controls="navbarNavDropdown"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
          <!-- nav mid -->
          <ul class="navbar-nav ms-auto" id="linker">
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="/">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/about">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/documentation">Documentation</a>
            </li>
            <li class="nav-item">
              <a id="active" class="nav-link" href="/tours">Tours</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/cek_pesanan">Cek Pesanan</a>
            </li>
          </ul>
          <!-- nav mid -->

          <!-- nav login -->
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="#"
                ><button
                  style="color: white; font-weight: 500"
                  class="Login btn btn-warning px-4 py-2"
                >
                  Login
                </button></a
              >
            </li>
          </ul>
          <!-- nav login -->
        </div>
      </div>
    </nav>
    <!-- navbar -->

    <!-- Hero -->
    <div id="Hero" style="height: 500px; background-position: top;">
      <div class="fcontainer">
        <div class="container">
          <div class="row">
            <div class="col-12 text-center">
              <h1 style="color: white; font-weight: 800">
                TOURS <span style="color: orange">MeBest Travel</span>
              </h1>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Hero -->

    <!-- Content -->
    <section
      style="display: grid; height: 100%; place-items: center; margin-top: 4rem"
    >
      <div class="search-box">
        <input type="text" placeholder="Search Tours" />
        <div class="search-icon">
          <i class="fas fa-search"></i>
        </div>
        <div class="cancel-icon">
          <i class="fas fa-times"></i>
        </div>
        <div class="search-data"></div>
      </div>
    </section>

    <script>
      const searchBox = document.querySelector(".search-box");
      const searchBtn = document.querySelector(".search-icon");
      const cancelBtn = document.querySelector(".cancel-icon");
      const searchInput = document.querySelector("input");
      const searchData = document.querySelector(".search-data");
      searchBtn.onclick = () => {
        searchBox.classList.add("active");
        searchBtn.classList.add("active");
        searchInput.classList.add("active");
        cancelBtn.classList.add("active");
        searchInput.focus();
        if (searchInput.value != "") {
          var values = searchInput.value;
          searchData.classList.remove("active");
        } else {
          searchData.textContent = "";
        }
      };
      cancelBtn.onclick = () => {
        searchBox.classList.remove("active");
        searchBtn.classList.remove("active");
        searchInput.classList.remove("active");
        cancelBtn.classList.remove("active");
        searchData.classList.toggle("active");
        searchInput.value = "";
      };

      
    </script>

    <section>
      <div
        class="container-fluid"
        style="margin-top: 50px; margin-bottom: 50px"
      >
        <div class="row">
          {% for tour in tours_data %}
            <div class="col-lg-3 col-md-6 d-flex justify-content-center mt-3">
              <div class="card shadow" style="width: 18rem">
                <div class="cardImage">
                  <img src="{{ tour.image_path }}" class="card-img-top" alt="Tour Image" />
                </div>
                <div class="card-body">
                  <h5 class="card-title">{{ tour.title }}</h5>
                  <p class="card-text">
                    {% set words = tour.description.split() %}
                    {% if words | length > 11 %}
                      {{ ' '.join(words[:11]) + '...' }}
                    {% else %}
                      {{ tour.description }}
                    {% endif %}
                  </p>
                  <p class="card-text">Price: {{ tour.price }}</p>
                  <div class="text-center">
                    <a href="#" class="btn btn-primary">Details</a>
                    <p></p>
                  </div>
                  <div class="text-center" id="button_admin_card">
                    <button
                      type="button"
                      class="btn btn-warning"
                      data-bs-toggle="modal"
                      data-bs-target="#editTourModal"
                      data-id="{{ tour._id }}"
                    >
                      Edit
                    </button>
                    <button
                      type="button"
                      class="btn btn-danger"
                      data-bs-toggle="modal"
                      data-bs-target="#deleteTourModal"
                      data-id="{{ tour._id }}"
                    >
                      Delete
                    </button>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </section>

    <section>
      <div
        class="container-fluid"
        style="margin-bottom: 50px; margin-top: 50px"
      >
        <div class="row">
          <div class="col-lg-12">
            <div class="TambahTour">
              <div class="text-center" id="button_admin_add">
                <button
                  class="btn btn-outline-warning"
                  data-bs-toggle="modal"
                  data-bs-target="#addTourModal"
                >
                  Add Tours
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Modal Add Tours -->
    
      <!-- Field formulir Anda -->
      <div
        class="modal fade"
        id="addTourModal"
        tabindex="-1"
        aria-labelledby="addTourModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="addTourModalLabel">Add Tour</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form id="addTourForm" action="/add_tour" method="post" enctype="multipart/form-data">
                <div class="mb-3">
                  <label for="tourTitle" class="form-label">Tour Title</label>
                  <input
                    type="text"
                    class="form-control"
                    id="tourTitle"
                    name="tourTitle"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="tourDescription" class="form-label"
                    >Tour Description</label
                  >
                  <textarea
                    class="form-control"
                    id="tourDescription"
                    name="tourDescription"
                    rows="3"
                    required
                  ></textarea>
                </div>
                <div class="mb-3">
                  <label for="tourPrice" class="form-label">Tour Price</label>
                  <input
                    type="number"
                    class="form-control"
                    id="tourPrice"
                    name="tourPrice"
                    required
                  />
                </div>
                <div class="mb-3">
                  <label for="tourImage" class="form-label">Upload Image</label>
                  <input
                    type="file"
                    class="form-control"
                    id="tourImage"
                    name="tourImage"
                    accept="image/*"
                    required
                  />
                </div>
                <button type="submit" class="btn btn-primary">Add Tour</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    
    <!-- Modal Edit Tour -->

    <!-- EndContent -->
    <div class="modal fade" id="editTourModal" tabindex="-1" aria-labelledby="editTourModalLabel" aria-hidden="true">
      <div class="modal-dialog">
          <div class="modal-content">
              <div class="modal-header">
                  <h5 class="modal-title" id="editTourModalLabel">Edit Tour</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                  <form id="editTourForm" action="/update_tour" method="post" enctype="multipart/form-data">
                      <input type="hidden" id="editTourId" name="editTourId" value="" />
                      <div class="mb-3">
                          <label for="editTourTitle" class="form-label">Tour Title</label>
                          <input type="text" class="form-control" id="editTourTitle" name="editTourTitle" required />
                      </div>
                      <div class="mb-3">
                          <label for="editTourDescription" class="form-label">Tour Description</label>
                          <textarea class="form-control" id="editTourDescription" name="editTourDescription" rows="3" required></textarea>
                      </div>
                      <div class="mb-3">
                          <label for="editTourPrice" class="form-label">Tour Price</label>
                          <input type="number" class="form-control" id="editTourPrice" name="editTourPrice" required />
                      </div>
                      <div class="mb-3">
                          <label for="editTourImage" class="form-label">Upload Image</label>
                          <input type="file" class="form-control" id="editTourImage" name="editTourImage" accept="image/*" required />
                      </div>
                      <button type="submit" class="btn btn-warning">Save Changes</button>
                  </form>
              </div>
          </div>
      </div>
    </div>


    <!-- Modal Delete Tours -->
    <div
      class="modal fade"
      id="deleteTourModal"
      tabindex="-1"
      aria-labelledby="deleteTourModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="deleteTourModalLabel">Delete Tour</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <p>Are you sure you want to delete this tour?</p>
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-danger" id="confirmDeleteTour">
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Script Modal -->
    <script>
      $(document).on("submit", "#addTourForm", function (e) {
        e.preventDefault();

        $("#addTourModal").modal("hide");
      });

      $(document).on("submit", "#editTourForm", function (e) {
        e.preventDefault();

        $("#editTourModal").modal("hide");
      });

      $(document).on("click", "#confirmDeleteTour", function () {
        var tourId = $("#deleteTourModal").data("id");

        $("#deleteTourModal").modal("hide");
      });

      $("#editTourModal").on("show.bs.modal", function (event) {
        var button = $(event.relatedTarget);
        var tourId = button.data("id");

        // Mengisi nilai sebelumnya pada modal
        $("#editTourId").val(tourId);
        $("#editTourTitle").val(button.closest(".card").find(".card-title").text());
        $("#editTourDescription").val(button.closest(".card").find(".card-text:first").text());
        $("#editTourPrice").val(button.closest(".card").find(".card-text:last").text());
        
        // Menampilkan gambar saat ini
        var currentImage = button.closest(".card").find("img").attr("src");
        $("#currentTourImage").attr("src", currentImage);
      });


      $(document).on("click", "#confirmDeleteTour", function () {
        var tourId = $("#deleteTourModal").data("id");

        // Menggunakan AJAX untuk menghapus tour
        $.ajax({
          type: 'POST',
          url: '/delete_tour',
          data: {'deleteTourId': tourId},
          success: function(response) {
            if (response.result === 'success') {
              // Refresh halaman setelah menghapus tour
              location.reload();
            } else {
              alert('Gagal menghapus tour: ' + response.msg);
            }
          },
          error: function(error) {
            console.error('Error:', error);
            alert('Terjadi kesalahan saat menghapus tour');
          }
        });
      });
    </script>

    <!-- footer -->
    <footer>
      <div class="container-fluid py-5" style="background-color: orange">
        <div class="row px-5">
          <div class="col-lg-4 col-md-12">
            <img src="/static/logo.png" width="200px" alt="" />
            <p class="" style="text-align: justify">
              Dengan menggunakan Me Best Travel, pengguna dapat dengan mudah merencanakan perjalanan wisata mereka tanpa
            harus repot mencari informasi dari berbagai sumber yang berbeda. Semua informasi dan layanan yang dibutuhkan
            dapat ditemukan dalam satu platform yang terpercaya dan terupdate.
            </p>
          </div>
          <div class="col-lg-2 col-md-12 offset-lg-2 offset-md-0">
            <h5 style="color: white">Feature</h5>
            <div class="mt-5">
              <a style="text-decoration: none" href=""
                ><p style="color: #252525">About</p></a
              >
              <a style="text-decoration: none" href=""
                ><p style="color: #252525">Documentation</p></a
              >
              <a style="text-decoration: none" href=""
                ><p style="color: #252525">Tours</p></a
              >
            </div>
          </div>

          <div class="col-lg-4 col-md-12">
            <h5 style="color: white">Sosial Media</h5>
            <div class="mt-5">
              <a style="text-decoration: none" href=""
                ><p style="color: #252525">Facebook : MeBest Travel</p></a
              >
              <a style="text-decoration: none" href=""
                ><p style="color: #252525">Instagram : MeBest_Travel</p></a
              >
              <a style="text-decoration: none" href=""
                ><p style="color: #252525">Kontak : 081237085281</p></a
              >
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!-- end footer -->

    <script>
      window.onscroll = function () {
        scrollFunction();
      };

      function scrollFunction() {
        if (
          document.body.scrollTop > 80 ||
          document.documentElement.scrollTop > 80
        ) {
          document.getElementById("navbar").style.backgroundColor = "orange";
          document.getElementById("active").style.color = "#ffffff";
          document.getElementById("active").style.borderBottom =
            "2px solid #ffffff";
        } else {
          document.getElementById("navbar").style.backgroundColor =
            "transparent";
          document.getElementById("navbar").style.transition = "0.3s";
          document.getElementById("active").style.color = "#ffa500";
          document.getElementById("active").style.borderBottom =
            "2px solid #ffa500";
        }

        $(document).ready(function(){
          {% if payloads.role == 2 %}
            $('.card-body #button_admin_card').addClass('d-none');
            $('#button_admin_add').addClass('d-none');
          {% else %}
            $('.card-body #button_admin_card').removeClass('d-none');
            $(' #button_admin_add').removeClass('d-none');
          {% endif %}
        })
      }
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
